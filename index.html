<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evolução</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111111">
    
<body>

<h1>Sistema de Evolução</h1>

<div class="card">
  <h3>Criar Nova Missão</h3>
  <input type="text" id="nomeMissao" placeholder="Nome da missão">
  
  <select id="atributoMissao">
    <option value="disciplina">Disciplina</option>
    <option value="forca">Força Física</option>
    <option value="intelecto">Intelecto</option>
    <option value="financeiro">Financeiro</option>
    <option value="espiritual">Espiritual</option>
    <option value="social">Social</option>
  </select>

  <input type="number" id="xpMissao" placeholder="XP (ex: 20)">
  <button onclick="criarMissao()">Criar Missão</button>
</div>

<div id="listaMissoes"></div>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}

let atributos = JSON.parse(localStorage.getItem("atributos")) || {
    disciplina:{xp:0,nivel:1},
    forca:{xp:0,nivel:1},
    intelecto:{xp:0,nivel:1},
    financeiro:{xp:0,nivel:1},
    espiritual:{xp:0,nivel:1},
    social:{xp:0,nivel:1}
};

let missoes = JSON.parse(localStorage.getItem("missoes")) || [];

function salvarTudo(){
  localStorage.setItem("atributos", JSON.stringify(atributos));
  localStorage.setItem("missoes", JSON.stringify(missoes));
}

function dataHoje(){
  return new Date().toISOString().split("T")[0];
}

function criarMissao(){
  if(missoes.length >= 10){
    alert("Limite de 10 missões atingido.");
    return;
  }

  let nome = document.getElementById("nomeMissao").value;
  let atributo = document.getElementById("atributoMissao").value;
  let xp = parseInt(document.getElementById("xpMissao").value);

  if(!nome || !xp) return alert("Preencha todos os campos.");

  missoes.push({
    id: Date.now(),
    nome,
    atributo,
    xp,
    concluidaHoje:false,
    dataConclusao:null
  });

  salvarTudo();
  atualizarMissoes();
}

function concluirMissao(id){
  let missao = missoes.find(m => m.id === id);

  if(missao.dataConclusao === dataHoje()){
    return alert("Já concluída hoje.");
  }

  atributos[missao.atributo].xp += missao.xp;

  if(atributos[missao.atributo].xp >= 100){
    atributos[missao.atributo].xp = 0;
    atributos[missao.atributo].nivel++;
    alert(missao.atributo.toUpperCase() + " subiu para nível " + atributos[missao.atributo].nivel);
  }

  missao.dataConclusao = dataHoje();

  salvarTudo();
  atualizarMissoes();
}

function atualizarMissoes(){
  let lista = document.getElementById("listaMissoes");
  lista.innerHTML = "";

  missoes.forEach(m => {
    let concluida = m.dataConclusao === dataHoje();

    lista.innerHTML += `
      <div class="card">
        <strong>${m.nome}</strong><br>
        Atributo: ${m.atributo}<br>
        XP: ${m.xp}<br>
        <button onclick="concluirMissao(${m.id})" ${concluida ? "disabled" : ""}>
          ${concluida ? "Concluída Hoje" : "Concluir"}
        </button>
      </div>
    `;
  });
}

atualizarMissoes();
</script>

</body>
</html>
